function getItunesLink(t,e){console.log(t),$.ajax({url:"https://itunes.apple.com/search/?term="+t,type:"GET",dataType:"jsonp",success:function(t){console.log("response:"),console.log(t);var s=t.results[0].collectionViewUrl;$(e).attr("href",s)},error:function(){alert('error on "getAlbumId"')}})}function getItunesData(t,e){var s=(t+"+"+e).replace(/ /g,"+").toLowerCase(),a="#itunes-button";getItunesLink(s,a)}function printOverlay(t,e,s){var a=t.artists[0].name,o=t.name,n=t.images[0].url,r=t.release_date,l=t.tracks.items,i=getItunesData(a,o);console.log(i),s+='<div id="js-image-overlay">',s+='<div id="js-overlay-wrapper">',s+='<button id="js-close-overlay" class="close-overlay">Close overlay</button>',s+='<img src="'+n+'" alt="" class="album-artwork">',s+='<section id="js-data-wrapper">',s+="<h1>"+o+"</h1>",s+="<p>By "+a+"</p>",s+='<p class="meta">Released on ',s+='<time datetime="'+r+'">'+r+"</time>",s+="</p>",s+='<ul class="play-list">',$.each(l,function(t,e){var a=e.name;s+='<li class="album-track">'+a+"</li>"}),s+='<a id="itunes-button" href="" class="cta-button">',s+='<img src="assets/itunes-badge.svg" alt="Get it oniTunes">',s+="</a>",s+="</ul>",s+="</section>",s+="</div>",s+="</div>",$("body").prepend(s),$(e).hide(),$(e).fadeIn(400),getItunesData(a,o)}function showDetails(t){var e=t;$.ajax({url:"https://api.spotify.com/v1/albums/"+e,success:function(t){var e=t,s,a="#js-image-overlay",o="#js-close-overlay",n=function(){var t=function(){$(a).remove()};$(a).fadeOut(400),setTimeout(t,400),$(document).off("keydown")},r=function(){$(o).click(function(){n()}),$(document).keyup(function(t){27===t.keyCode&&n()}),window.onclick=function(t){var e=t.target.id;"js-image-overlay"===e&&n()}};printOverlay(e,a,s),r()}})}function activateThumbnails(){$("a").click(function(t){var e=$(this).find("img").attr("id");t.preventDefault(),showDetails(e)})}function printResults(t,e){0===albums.length?e.html("<p>We have no search results for <strong>"+searchQuery+"</strong></p>"):($.each(albums,function(e,s){var a=s.id,o=s.name,n=s.thumb,r=s.release_date;t+='<li class="gallery-item">',t+='<a href="">',t+='<img id="'+a+'" src="'+n+'" alt="'+o+'">',t+="</a>",t+="<h2>"+o+"</h2>",t+='<p class="meta">',t+='<time datetime="'+r+'">'+r+"</time>",t+="</p>",t+="</li>"}),e.html(t))}function showResults(){var t;checkSortButtons(),printResults(t,imageGallery),activateThumbnails(),console.log("albums: "),console.log(albums)}function stripResults(t){var e=t.albums.items;$.each(e,function(t,e){var s={};s.id=e.id,s.name=e.name,s.thumb=e.images[1].url,$.ajax({url:"https://api.spotify.com/v1/albums/"+e.id,success:function(t){console.log("response: "),console.log(t),s.release_date=t.release_date},complete:showResults}),albums.push(s)})}function searchAlbums(){searchQuery=input.val(),albums=[],$.ajax({url:"https://api.spotify.com/v1/search",data:{q:searchQuery,type:"album"},success:stripResults})}function setButtons(t){forAttr=t,$("label").attr("data-state","deselected"),$('label[for="'+forAttr+'"]').attr("data-state","selected")}function checkSortButtons(){"name"===sortBy?sortResults(albums,sortByName):sortResults(albums,sortByDate)}function changeSortButtons(){var t=this.id;sortBy=t,setButtons(t),checkSortButtons(),showResults()}function sortByDate(t){t.sort(function(t,e){var s=t.release_date,a=e.release_date;return s<a?-1:s>a?1:0})}function sortByName(t){t.sort(function(t,e){var s=t.name,a=e.name;return s<a?-1:s>a?1:0})}function sortResults(t,e){e(t)}var input=$("#query"),searchQuery,imageGallery=$("#image-gallery"),albums,sortBy=$('input[type="radio"]:checked')[0].id;$(input).keyup(searchAlbums),function t(){var e=sortBy;setButtons(e)}(),$('input[type="radio"').change(changeSortButtons);